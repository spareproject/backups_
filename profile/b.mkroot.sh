#!/bin/env bash
###############################################################################################################################################################################################################
umask 077
if [[ ${1} ]];then
###############################################################################################################################################################################################################
PROFILE=${1}
PROFILE_="/mnt/profile/${PROFILE}"
###############################################################################################################################################################################################################
if [[ -d ${PROFILE_}/host/root ]];then
  while [[ ${QUERY} != @("y"|"n") ]];do
    read -r -p "root exists in profile:${PROFILE} delete? (y|n) " QUERY
    if [[ ${QUERY} == "y" ]];then
      rm -r ${PROFILE_}/host/root
    elif [[ ${QUERY} == "no" ]];then
      echo "root in profile:${PROFILE} already exists quiting..."
    fi
  done
fi
###############################################################################################################################################################################################################
mkdir -p ${PROFILE_}/host/root/gnupg
cp /etc/gnupg/gpg* ${PROFILE_}/host/root/gnupg/
OLD=$(stat -c %U $(tty));chown root:tty $(tty)
gpg --homedir ${PROFILE_}/host/root/gnupg --batch --gen-key /etc/gnupg/batch.root
chown ${OLD}:tty $(tty)
gpg --homedir ${PROFILE_}/host/root/gnupg --armor --output ${PROFILE_}/host/root/public.key --export root
###############################################################################################################################################################################################################
else
cat << EOF
give it a profile name prompts if root already exists
EOF
fi
